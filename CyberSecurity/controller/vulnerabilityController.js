const path = require("path")
const { exec } = require('child_process');
const fs = require('fs');
function checkDirectly(outputDir)
{
    // Ensure the output directory exists
    if (!fs.existsSync(outputDir)) {
        fs.mkdirSync(outputDir);
    }

}
function executeBash(scriptPath, ip, port, location, res) {
    exec(`bash ${scriptPath} ${ip} ${port} ${location}`, (error, stdout, stderr) => {
        if (error) {
            return res.status(500).json({ error: "Error while scan Vulnerabilities" });
        }
        if (stderr) {
            return res.status(500).json({ error: "Error while scan Vulnerabilities" });

        }
        return res.status(200).json({ message: "the scan is completed"})

    })
}
function scanVulnerability(req, res) {
    const ip = req.body.ip
    const port = req.body.port
    const pathBash = "bashs/vulnerability/scan.sh"
    let location = path.resolve(__dirname, '..');
    location = path.join(location, "views")
    checkDirectly(location)
    executeBash(pathBash, ip, port, location, res)
}

module.exports = { scanVulnerability }